<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />

    <title>火麒麟门户脚手架 - 脉络分析 & 模块详解</title>

    <link rel="stylesheet" href="./css/reveal.css" />
    <!-- 模板主题 -->
    <link rel="stylesheet" href="./css/theme/wx.css" />

    <!-- Theme used for syntax highlighting of code -->
    <link rel="stylesheet" href="plugin/iconfont/iconfont.css" />
    <link rel="stylesheet" href="./lib/css/zenburn.css" />
    <script src="./plugin/iconfont/iconfont.js"></script>
    <!-- Printing and PDF exports -->
    <script>
      var link = document.createElement('link');
      link.rel = 'stylesheet';
      link.type = 'text/css';
      link.href = window.location.search.match(/print-pdf/gi)
        ? 'css/print/pdf.css'
        : 'css/print/paper.css';
      document.getElementsByTagName('head')[0].appendChild(link);
    </script>
  </head>

  <body>
    <div class="reveal">
      <div class="slides">
        <section>
          <p>
            <img
              src="pic/avatar.jpg"
              height="200"
              width="200"
              alt=""
              style="border-radius: 50%; border: 4px solid #ddd;"
            />
          </p>
          <h1>火麒麟门户脚手架</h1>
          <h2><em>脉络分析 & 模块详解</em></h2>
          <div>
            <small style="font-style: italic;"
              >BSS产品线研发二部 <span style="margin: 0 5px;">/</span> soon<span
                style="margin: 0 5px;"
                >/</span
              >
              2020-04-28</small
            >
          </div>
        </section>
        <section class="text-left">
          <p class="text-center margin-bottom-lg">
            <!-- <span class="icon white nobordered lg"
              ><i class="iconfont icon-design"></i
            ></span> -->
            <svg aria-hidden="true">
              <use xlink:href="#icon-color-design6"></use>
            </svg>
          </p>
          <ul>
            <li>
              框架都是基于<span class="text-primary">预设场景</span
              >设计的，火麒麟脚手架也不例外。
            </li>
            <li>
              首先他是基于
              <span class="text-primary">react</span>
              生态圈构建的，其次<span class="text-primary">耦合</span
              >了uportal的后端服务。
            </li>
            <li>
              <span class="text-primary">自带</span
              >『工作台配置』『菜单管理』等13个功能模块。
            </li>

            <li><span class="text-primary">前后端分离</span>的。</li>
          </ul>
        </section>
        <section>
          <section>
            <p class="margin-bottom-lg">
              <svg aria-hidden="true">
                <use xlink:href="#icon-color-happy1"></use>
              </svg>
            </p>
            <p>如果预设的场景</p>
            <p>刚好覆盖你的需求，你又刚好没有代码上的历史包袱</p>
            <p>
              那么一键<a
                href="http://gitlab.iwhalecloud.com/soon/react-slick/tree/develop"
                target="_blank"
                >clone</a
              >你就继承了现有的13个模块以及各类前端资产
            </p>
            <p><em>Happy! </em></p>
          </section>
          <section>
            <p>
              <img src="./pic/asset1.jpg" alt="" />
            </p>
            <p class="text-primary">
              13个功能模块
            </p>
          </section>
          <section data-background-color="#fff" style="padding: 0;">
            <p>
              <canvas id="word_cloud" width="700" height="500"></canvas>
            </p>
            <p class="fs16">
              前端资产<a
                href="https://www.processon.com/view/link/5e399b40e4b021dc289976c0?pw=Uow7#map"
                target="_blank"
                >【详见2月分享】</a
              >
            </p>
          </section>
        </section>
        <section>
          <section>
            <p class="margin-bottom-lg">
              <!-- <span class="icon white nobordered lg"
              ><i class="iconfont icon-boom"></i
            ></span> -->
              <svg aria-hidden="true">
                <use xlink:href="#icon-color-boom"></use>
              </svg>
            </p>
            <p>如果预设场景满足不了你的需求</p>
            <p>改造过程可能就会</p>
            <p><span class="text-primary">出现意外 </span></p>
          </section>
          <section class="text-left">
            <h2 class="text-primary margin-bottom-lg">比如这些场景</h2>
            <div class="media-box">
              <div class="media-right">
                <img
                  src="./pic/bug.webp"
                  width="500"
                  alt=""
                  class="bordered0"
                />
              </div>
              <div class="media-body">
                <ul>
                  <li>Layout改造</li>
                  <li>登录/菜单相关的接口服务改造</li>
                  <li>登录界面UI改造</li>
                  <li>others...</li>
                </ul>
                <div class="media-body-text-hack"></div>
              </div>
            </div>
          </section>
        </section>
        <section>
          <section>
            <p class="margin-bottom-lg">
              <svg aria-hidden="true">
                <use xlink:href="#icon-color-mind"></use>
              </svg>
            </p>
            <h2><span class="text-primary">脉络分析</span></h2>
            <p class="fs20">
              主要指全局设计的脉络，比如：layout控制、访问权限校验等。不包括pages下的业务模块。
            </p>
            <p class="fs20">
              因为移除不需要的业务模块，并不会影响整体的运行。
            </p>
          </section>
          <section>
            <ul class="col2 clearfix">
              <li>
                <div class="media-box">
                  <div class="media-left" style="margin-right: 8px;">
                    <span class="icon orange"
                      ><i class="iconfont icon-data"></i
                    ></span>
                  </div>
                  <div class="media-body">
                    <div class="title">3个model</div>
                    <div class="desc">
                      login / menu / settings
                    </div>
                    <div class="media-body-text-hack"></div>
                  </div>
                </div>
              </li>
              <li>
                <div class="media-box">
                  <div class="media-left" style="margin-right: 8px;">
                    <span class="icon"
                      ><i class="iconfont icon-router"></i
                    ></span>
                  </div>
                  <div class="media-body">
                    <div class="title">4个layout</div>
                    <div class="desc">
                      UserLayout / BasicLayout / Exception / Locked
                    </div>
                    <div class="media-body-text-hack"></div>
                  </div>
                </div>
              </li>
            </ul>
          </section>
          <section>
            <h2><span class="text-primary">火麒麟门户</span></h2>
          </section>
          <section
            data-background-iframe="http://172.16.81.126:9999/portal-react/"
            data-background-interactive
          ></section>
          <!-- <section>
            <ol>
              <li>
                <p>
                  访问门户时，从输入链接回车到显示页面，期间执行了哪些逻辑？
                </p>
              </li>
              <li><p>访问权限（页面级）的校验机制是什么？</p></li>
              <li><p>viewMode=inner如何实现的？</p></li>
            </ol>
          </section> -->
          <section>
            <h2><span>3个model</span></h2>
          </section>
          <section data-background-color="#2b2f3a">
            <img
              src="./pic/model_login.jpg"
              alt=""
              style="border: none; box-shadow: none;"
            />
          </section>
          <section data-background-color="#2b2f3a">
            <img
              src="./pic/model_menu.jpg"
              alt=""
              style="border: none; box-shadow: none;"
            />
          </section>
          <section data-background-color="#2b2f3a">
            <img
              src="./pic/model_settings.jpg"
              alt=""
              style="border: none; box-shadow: none;"
            />
          </section>
          <section>
            <h2>4个layout</h2>
            <p class="text-gray">
              http://172.16.81.126:9999/portal-react/#/notice
            </p>
            <p class="text-gray">
              以访问公告页为例
            </p>
          </section>
          <section class="text-left" style="padding: 0;">
            <h2 class="text-center">依次命中</h2>
            <ol class="fs20">
              <li class="fragment">
                <p>global.js</p>
                <p class="margin-left text-gray fs20">
                  挂载补丁，如：国际化、ie标识（用于css兼容）等
                </p>
              </li>
              <li class="fragment">
                <p>app.js</p>
                <p class="margin-left text-gray fs20">
                  用于运行时的配置（暂时没用）
                </p>
              </li>
              <li class="fragment">
                <p>layouts/index.js</p>
                <p class="margin-left text-gray fs20">
                  a. 向后台查询当前用户的登录状态，总共有5种状态。
                </p>
                <p class="margin-left text-gray fs20">
                  b.
                  根据不同的status，对应的更新model和渲染layout（viewMode值不同渲染layout策略不一样）
                </p>
                <p class="margin-left text-gray fs20">
                  c.
                  如果是'LOGINED'，进一步查询菜单数据all，同时根据pathname遍历all，完成访问权限校验
                </p>
                <p class="margin-left text-gray fs20">
                  d. viewMode='noraml | inner'的处理差异
                </p>
              </li>
            </ol>
          </section>
          <section class="text-left">
            <h2 class="text-center">关于a&b</h2>
            <p class="text-gray fs20">
              总共5个<a href="#/4/5">状态</a
              >，涉及到logged.do和status.do两个接口。
            </p>
            <ul class="fs20 fragment">
              <li>
                <p>'CONFIRMING'</p>
                <p class="margin-left text-gray fs20">
                  『查询中』model中status的初始值，此时界面显示loading。
                  <small>注：初始值不是 'LOG_OUT'</small>
                </p>
              </li>
              <li class="fragment">
                <p>'LOG_OUT'</p>
                <p class="margin-left text-gray fs20">
                  『未登录』更新<a href="#/4/5">login</a
                  >中的status为'LOG_OUT'；路由到<span class="text-primary"
                    >UserLayout</span
                  >;
                </p>
              </li>
              <li class="fragment">
                <p>'SESSION_TIME_OUT'</p>
                <p class="margin-left text-gray fs20">
                  『状态失效』通知后台登出；重置<a href="#/4/5">login</a
                  >中的status和user；路由到<span class="text-primary"
                    >UserLayout</span
                  >;
                </p>
              </li>
              <li class="fragment">
                <p>'LOCKED'</p>
                <p class="margin-left text-gray fs20">
                  『锁屏』更新<a href="#/4/5">login</a
                  >和sessionStorage中的status和user；路由到<span
                    class="text-primary"
                    >Locked</span
                  >;
                </p>
              </li>
              <li class="fragment">
                <p>'LOGINED'</p>
                <p class="margin-left text-gray fs20">
                  『已登录』更新<a href="#/4/5">login</a
                  >；更新sessionStorage中的user和status；然后查询菜单数据，并校验访问权限。最后路由到<span
                    class="text-primary"
                    >BasicLayout</span
                  >；
                </p>
              </li>
            </ul>
          </section>
          <section class="text-left fs20">
            <h2 class="margin-bottom-lg text-center">关于c</h2>
            <p>
              变成'LOGINED'之后，'layouts/index.js'还执行了哪些逻辑？
            </p>
            <ol>
              <li class="fragment">
                <p>获取menu数据</p>
                <p class="margin-left text-gray fs20">
                  期间，界面显示loading
                </p>
                <p class="margin-left text-gray fs20">
                  成功，更新model中的<a href="#/4/6">menu</a>，同时路由到<span
                    class="text-primary"
                    >BasicLayout</span
                  >
                </p>
                <p class="margin-left text-gray fs20">
                  失败，路由到<span class="text-primary">Exception</span>
                </p>
              </li>
              <li class="fragment">
                <p>访问权限判断</p>
                <p class="margin-left text-gray fs20">
                  取当前的pathname在<a href="#/4/6">menu</a
                  >中遍历。存在路由到<span class="text-primary"
                    >BasicLayout</span
                  >，否则路由到<span class="text-primary">Exception</span>
                </p>
                <p class="margin-left text-gray fs20">
                  遍历时需要区分是iframe页面还是门户自带页面，详见_findMenu()方法
                </p>
              </li>
              <li class="fragment">
                <p>其他...</p>
                <p class="margin-left text-gray fs20">
                  『记录』 在sessionStorage中记录用户最后操作的时间。
                </p>
                <p class="margin-left text-gray fs20">
                  『轮询』根据记录的最后超时时间，每隔60秒轮询登录状态。
                </p>
                <p class="margin-left text-gray fs20">
                  『水印』给内页添加水印,开关在defaultSetting
                </p>
              </li>
            </ol>
          </section>
          <section class="text-left fs20">
            <h2 class="margin-bottom-lg text-center">关于d</h2>
            <p>在页面初始化时，model setting会自动识别，并设置viewMode初始值</p>
            <ul>
              <li class="fragment">
                <p>
                  viewMode
                </p>
                <p class="margin-left text-gray fs20">
                  表示视图模式，两个可选值：<span class="text-primary"
                    >inner</span
                  >
                  |
                  <span class="text-primary">normal</span>。普通视图和内嵌视图
                </p>
              </li>
              <li class="fragment">
                <p>通过url传参</p>
                <p class="margin-left text-gray fs20">
                  如：'?viewMode=inner'。
                </p>
              </li>
              <li class="fragment">
                <p>normal</p>
                <p class="margin-left text-gray fs20">
                  不传，表示normal模式。
                </p>
              </li>
              <li class="fragment">
                <p>inner</p>
                <p class="margin-left text-gray fs20">
                  『适用场景』 由这套脚手架构建的页面，被集成到第三方的门户。
                </p>
                <p class="margin-left text-gray fs20">
                  『区别』inner不会路由到UserLayout、Locked，且BasicLayout不显示Header和TabBar。采用单点接口请求用户信息
                </p>
              </li>
            </ul>
          </section>
          <section class="text-left">
            <h2 class="text-center">UserLayout</h2>
            <ol class="fs20">
              <li>
                <p>四种情况</p>
                <p class="margin-left text-gray">
                  4种情况会被路由到登录页：直接访问user/login；手动登出；logged.do查询未登录；status.do轮询sessionId超时；
                </p>
              </li>
              <li class="fragment">
                <p>四个场景</p>
                <p class="margin-left text-gray">
                  覆盖普通登录、带验证码登录、强制登录和初始密码修改提醒4个场景的需求。涉及到<a
                    href="#/4/5"
                    >login</a
                  >中的另外3个字段：'needVerifyCode', 'needModifyPsw',
                  'forceLogin'
                </p>
              </li>
              <!-- <li class="fragment">
                <p>进入内页的前置条件</p>
                <p class="margin-left text-gray">
                  必须凑齐login.user, login.status和
                  menu，并且对应更新sessionStorage中的status和user；
                </p>
              </li> -->
            </ol>
          </section>
          <section class="text-left">
            <h2 class="text-center">BasicLayout</h2>
            <ul class="fs20">
              <li>
                <p>Tabs插槽</p>
                <p class="marginn-left text-gray">
                  <a
                    href="https://3x.ant.design/components/tabs-cn/#components-tabs-demo-editable-card"
                    >Tabs样例</a
                  >
                  menu中必须包含这4个字段：menuId,urlAddr,menuName,menuCode
                </p>
              </li>
              <li>
                <p>画布监听</p>
                <p class="marginn-left text-gray">
                  随窗口size变化，即时更新<a href="#/4/7">setting.size</a>
                </p>
              </li>
              <li>
                <p>风格定义</p>
                <p class="marginn-left text-gray">
                  <a href="#/4/7">setting</a
                  >中的相关字段：showLeftMenu、enableWatermark、enableLanguage、loginRedirect、SESSION_PREFIX
                </p>
              </li>
            </ul>
          </section>
          <section class="text-left">
            <h2 class="text-center">Exception</h2>
            <ul>
              <li>
                <p>403</p>
                <p class="margin-left text-gray fs20">
                  inner模式下状态失效或访问/user/login，路由到403页面
                </p>
                <p class="margin-left text-gray fs20">
                  normal模式下暂未使用。
                </p>
              </li>
              <li>
                <p>404</p>
                <p class="margin-left text-gray fs20">
                  访问allMenu中不存在的页面，路由到404页面
                </p>
              </li>
              <li>
                <p>500</p>
                <p class="margin-left text-gray fs20">
                  menu数据获取异常，路由到500页面
                </p>
              </li>
            </ul>
          </section>
          <section class="text-left">
            <h2 class="text-center">Locked</h2>
            <ol>
              <li>
                <p>主动锁屏</p>
                <p class="margin-left text-gray fs20">
                  暂未实现。指内页右上角锁屏功能
                </p>
              </li>
              <li>
                <p>被动锁屏</p>
                <p class="margin-left text-gray fs20">
                  在status.do定时轮询时，通过dispatch({type:'login/lock'})触发
                </p>
              </li>
            </ol>
          </section>
        </section>
        <section>
          <section>
            <h2><span class="text-primary">模块详解</span></h2>
          </section>
          <section>            
            <p class="text-left fs20">主要讲解的是全局相关的模块Dashboard</p>
            <ol>
              <li class="fragment">
                <p>优先级</p>
                <p class="margin-left text-gray fs20">
                  用户模板优先级大于角色模板，前者未配置时默认取后者。接口服务getTempletModuleReact.do
                </p>
              </li>
              <li class="fragment">
                <p>portlet</p>
                <p class="margin-left text-gray fs20">
                  『目录』目前统一放在Dashboard/components目录下
                </p>
                <p class="margin-left text-gray fs20">
                  『尺寸』开发portlet时，在const.js里必须给每个声明宽高的最大最小值。
                </p>
                <p class="margin-left text-gray fs20">
                  『类型』支持本地和第三方(以iframe接入)两种类型。
                </p>
                <p class="margin-left text-gray fs20">
                  『配置』在菜单管理<span class="text-primary">按约定格式</span
                  >增加菜单，然后分配账号权限，最后在工作台模板配置中添加才能被显示
                </p>
              </li>
              <li class="fragment">
                <p>react-grid-layout</p>
                <p class="margin-left text-gray fs20">
                  驱动portlet的拖拽、resize的第三方插件
                </p>
              </li>
              <li class="fragment">
                <p>待提升</p>
                <p class="margin-left text-gray fs20">
                  放开目录的约束，适配个性化版本代码全部放在local目录的需求
                </p>
                <p class="margin-left text-gray fs20">
                  通过defaultSettings指定首页，适配不需要首页模板配置的项目需求
                </p>
              </li>
            </ol>
          </section>
        </section>

        <section>
          <h2><em>分享完毕</em></h2>
          <p>
            <a
              href="http://gitlab.iwhalecloud.com/soon/react-slick/tree/develop"
              target="_blank"
              >更多说明</a
            >
            | <a href="http://30lph6.coding-pages.com/1/#/"  target="_blank">前置知识</a> |
            <a
              href="https://www.processon.com/view/link/5e399b40e4b021dc289976c0?pw=Uow7#map"
              target="_blank"
              >资产脑图</a
            >
          </p>
          <p>: )</p>
        </section>
      </div>
    </div>

    <script src="./lib/js/head.min.js"></script>
    <script src="./js/reveal.js"></script>
    <script src="./plugin/wordcloud2.js"></script>

    <script>
      // More info https://github.com/hakimel/reveal.js#configuration
      Reveal.initialize({
        width: 1002,
        height: 800,
        // margin: 0,
        minScale: 1,
        // maxScale: 1,
        history: true,
        slideNumber: true,
        controls: true,
        transition: 'convex',
        // mouseWheel: true,
        // autoSlide: 1000 ,
        // More info https://github.com/hakimel/reveal.js#dependencies
        dependencies: [
          {
            src: './plugin/markdown/marked.js',
          },
          {
            src: './plugin/markdown/markdown.js',
          },
          {
            src: './plugin/notes/notes.js',
            async: true,
          },
          {
            src: './plugin/zoom-js/zoom.js',
            async: true,
          },
          {
            src: './plugin/highlight/highlight.js',
            async: true,
            callback: function () {
              hljs.initHighlightingOnLoad();
            },
          },
        ],
      });

      var db = [
        { word: 'react', freq: 70 },
        { word: 'Antd', freq: 38 },
        { word: 'umi', freq: 38 },
        { word: 'dva', freq: 28 },
        { word: 'node', freq: 38 },
        { word: 'Less', freq: 26 },
        { word: 'CSS Module', freq: 22 },
        { word: 'ES6', freq: 20 },
        { word: 'bizcharts', freq: 20 },
        { word: 'request', freq: 20 },
        { word: 'SlickTable', freq: 18 },
        { word: 'ComboGrid', freq: 18 },
        { word: 'SlickUpload', freq: 18 },
        { word: 'Iconfont', freq: 17 },
        { word: 'ScrollBar', freq: 16 },
        { word: 'lodash', freq: 15 },
        { word: '@umijs/hooks', freq: 15 },
        { word: 'numeral', freq: 15 },
        { word: 'moment', freq: 15 },
        { word: 'memoize-one', freq: 14 },
        { word: 'prop-types', freq: 14 },
        { word: 'Mock', freq: 14 },
        { word: '接口代理', freq: 18 },
        { word: '布局规范', freq: 18 },
        { word: '通栏', freq: 14 },
        { word: '双栏', freq: 13 },
        { word: '国际化', freq: 13 },
        { word: '数据流', freq: 13 },
        { word: '集成设计', freq: 12 },
        { word: '双栏自适应', freq: 24 },
        { word: '垂直居中', freq: 12 },
        { word: 'Form', freq: 14 },
        { word: 'Table', freq: 12 },
        { word: 'Upload', freq: 15 },
        { word: '8', freq: 18 },
        { word: 'Card', freq: 17 },
        { word: '工具类', freq: 26 },
        { word: '离线包', freq: 26 },
        { word: 'Yarn', freq: 18 },
        { word: 'UI规范', freq: 18 },
        { word: '24', freq: 18 },
        { word: '63', freq: 18 },
        { word: '自定义组件', freq: 18 },
        { word: 'css', freq: 18 },
        { word: 'utils', freq: 18 },
        { word: 'classnames', freq: 18 },
        { word: '$.ajax', freq: 14 },
      ];

      list = [];
      for (var i in db) {
        list.push([db[i]['word'], db[i]['freq']]);
      }

      WordCloud.minFontSize = '15px';
      WordCloud(document.getElementById('word_cloud'), {
        list: list,
        gridSize: 22,
        fontFamily: 'Source Sans Pro',
        backgroundColor: '#fff',
      });
    </script>
    <script>
      var _hmt = _hmt || [];
      (function () {
        var hm = document.createElement('script');
        hm.src = 'https://hm.baidu.com/hm.js?6e1cd5de3acfa4c86bc47173f187a17c';
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(hm, s);
      })();
    </script>
  </body>
</html>
